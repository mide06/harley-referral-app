<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="img1.png" href="favicon.png">
    <title>harlay hub</title>
    <!-- Optional: set backend API base here to override auto-detection. Example: http://localhost:3000 -->
    <meta name="api-base" content="">
    <link rel="stylesheet" href="./sur.css">

    
</head>
<body>
  <form id="surveyForm">
    <div class="container">
      <!-- SECTION 1 -->
      <div class="container1" id="con1">
        <div class="header">
          <h1>Survey <span style="color: blue;">Form</span></h1>
        </div>

        <div class="input1">
          <label for="name" class="label1">Full name:</label>
          <input type="text" name="name" id="name" placeholder="Your full name" required><br><br>

          <label for="email" class="label1">Email:</label>
          <input type="email" name="email" id="email" required><br><br>
        </div>

        <div class="button1">
          <button type="button" id="button1">Next</button>
        </div>
        <div id="message" style="margin-top:1rem;color:green;display:none;"></div>
        <div id="error" style="margin-top:1rem;color:red;display:none;"></div>
      </div>

      <!-- SECTION 2 -->
      <div class="container1" id="con2">
        <h2>General <span style="color: blue;">Information</span></h2>

        <label for="address">Full address of the house (short answer)</label><br><br>
        <input type="text" name="address" id="address"><br><br>

        <hr>

        <label>Type of House (Multiple Choice)</label><br><br>
        <input type="radio" name="house_type" value="Flat" class="checkbox" id="house_flat">
        <label for="house_flat">Flat</label><br><br>

        <input type="radio" name="house_type" value="Single-Room" class="checkbox" id="house_single">
        <label for="house_single">Single-Room</label><br><br>

        <input type="radio" name="house_type" value="Self Contain" class="checkbox" id="house_self">
        <label for="house_self">Self Contain</label><br><br>

        <input type="radio" name="house_type" value="Other" class="checkbox" id="house_other">
        <label for="house_other">Other</label><br><br>

        <hr>

        <label for="rent_amount">Rent amount</label><br><br>
        <input type="number" name="rent_amount" id="rent_amount"><br><br>

        <hr>

        <label>Payment Terms</label><br><br>
        <input type="radio" name="payment_method" value="Transfer" class="checkbox" id="payment_transfer">
        <label for="payment_transfer">Transfer</label><br><br>

        <input type="radio" name="payment_method" value="Cash" class="checkbox" id="payment_cash">
        <label for="payment_cash">Cash</label><br><br>

        <hr>

        <label>Available Contact</label><br><br>
        <input type="radio" name="available_contact" value="Landlord Contact" class="checkbox" id="contact_landlord">
        <label for="contact_landlord">Landlord Contact</label><br><br>

        <input type="radio" name="available_contact" value="Caretaker Contact" class="checkbox" id="contact_caretaker">
        <label for="contact_caretaker">Caretaker Contact</label><br><br>

        <div class="np">
          <div class="previous"><button type="button">Previous</button></div><br>
          <div class="next"><button type="button">Next</button></div>
        </div>
      </div>

      <!-- SECTION 3 -->
      <div class="container1" id="con3">
        <h2>Structural and Building Quality</h2>

        <label>Wall Condition (Multiple choice)</label><br><br>
        <input type="radio" name="wall_condition" value="Good" class="checkbox" id="wall_good">
        <label for="wall_good">Good</label><br>

        <input type="radio" name="wall_condition" value="Minor Cracks" class="checkbox" id="wall_minor">
        <label for="wall_minor">Minor cracks</label><br>

        <input type="radio" name="wall_condition" value="Major Cracks" class="checkbox" id="wall_major">
        <label for="wall_major">Major cracks</label><br>

        <input type="radio" name="wall_condition" value="Dampness" class="checkbox" id="wall_damp">
        <label for="wall_damp">Dampness</label><br><br>

        <hr>

        <label>Flooring Type (Multiple choice)</label><br><br>
        <input type="radio" name="flooring_type" value="Tiles" class="checkbox" id="floor_tiles">
        <label for="floor_tiles">Tiles</label><br><br>

        <input type="radio" name="flooring_type" value="Cement" class="checkbox" id="floor_cement">
        <label for="floor_cement">Cement</label><br><br>

        <input type="radio" name="flooring_type" value="No Flooring" class="checkbox" id="floor_none">
        <label for="floor_none">No Flooring</label><br><br>

        <hr>

        <label>Ceiling Type (Multiple choice)</label><br><br>
        <input type="radio" name="ceiling_type" value="POP" class="checkbox" id="ceiling_pop">
        <label for="ceiling_pop">POP</label><br>

        <input type="radio" name="ceiling_type" value="PVC" class="checkbox" id="ceiling_pvc">
        <label for="ceiling_pvc">PVC</label><br>

        <input type="radio" name="ceiling_type" value="Asbestos" class="checkbox" id="ceiling_asbestos">
        <label for="ceiling_asbestos">Asbestos</label><br>

        <input type="radio" name="ceiling_type" value="Wood" class="checkbox" id="ceiling_wood">
        <label for="ceiling_wood">Wood</label><br>

        <hr><br>

        <label>Roof Condition:</label><br><br>
        <input type="radio" name="roof_condition" value="No leaks" class="checkbox" id="roof_none">
        <label for="roof_none">No leaks</label><br>

        <input type="radio" name="roof_condition" value="Minor leaks" class="checkbox" id="roof_minor">
        <label for="roof_minor">Minor leaks</label><br><br>

        <input type="radio" name="roof_condition" value="Serious leaks" class="checkbox" id="roof_serious">
        <label for="roof_serious">Serious leaks</label><br><br>

        <hr><br>

        <label for="number_of_windows">Number of windows (Short answer):</label><br>
        <input type="text" name="number_of_windows" id="number_of_windows"><br><br>

        <hr>

        <label>Window Condition:</label><br><br>
        <input type="radio" name="window_condition" value="Cross ventilation" class="checkbox" id="window_cross">
        <label for="window_cross">Cross ventilation</label><br>

        <input type="radio" name="window_condition" value="Mosquito net" class="checkbox" id="window_mosquito">
        <label for="window_mosquito">Mosquito net</label><br>

        <input type="radio" name="window_condition" value="Burglary Proof" class="checkbox" id="window_burglary">
        <label for="window_burglary">Burglary Proof</label><br>

        <input type="radio" name="window_condition" value="Other" class="checkbox" id="window_other">
        <label for="window_other">Other</label><br><br>

        <div class="np">
          <div class="previous"><button type="button">Previous</button></div><br>
          <div class="next"><button type="button">Next</button></div>
        </div>
      </div>
        <!-- SECTION 4 -->

          <!-- SECTION 4 -->
      <div class="container1" id="con4">
        <h2>Facilities and Amenities</h2>

        <label>Electricity Availability</label><br><br>
        <input type="radio" name="electricity" value="Stable" class="checkbox" id="elec_stable">
        <label for="elec_stable">Stable</label><br>

        <input type="radio" name="electricity" value="Unstable" class="checkbox" id="elec_unstable">
        <label for="elec_unstable">Unstable</label><br>

        <input type="radio" name="electricity" value="None" class="checkbox" id="elec_none">
        <label for="elec_none">None</label><br><br>

        <hr>

        <label>Water Supply Type</label><br><br>
        <input type="radio" name="water_supply" value="Borehole" class="checkbox" id="water_borehole">
        <label for="water_borehole">Borehole</label><br>

        <input type="radio" name="water_supply" value="Well" class="checkbox" id="water_well">
        <label for="water_well">Well</label><br>

        <input type="radio" name="water_supply" value="Tap Water" class="checkbox" id="water_tap">
        <label for="water_tap">Tap Water</label><br>

        <input type="radio" name="water_supply" value="None" class="checkbox" id="water_none">
        <label for="water_none">None</label><br><br>

        <hr>

        <label>Waste Disposal System</label><br><br>
        <input type="radio" name="waste_disposal" value="Public collection" class="checkbox" id="waste_public">
        <label for="waste_public">Public collection</label><br>

        <input type="radio" name="waste_disposal" value="Private service" class="checkbox" id="waste_private">
        <label for="waste_private">Private service</label><br>

        <input type="radio" name="waste_disposal" value="Dump site" class="checkbox" id="waste_dump">
        <label for="waste_dump">Dump site</label><br>

        <input type="radio" name="waste_disposal" value="Burning" class="checkbox" id="waste_burning">
        <label for="waste_burning">Burning</label><br><br>

        <div class="np">
          <div class="previous"><button type="button">Previous</button></div><br>
          <div class="next"><button type="button">Next</button></div>
        </div>
      </div>

      <!-- SECTION 5 -->
      <div class="container1" id="con5">
        <h2>Safety and Security</h2>

        <label>Neighborhood Safety</label><br><br>
        <input type="radio" name="neighborhood_safety" value="Very safe" class="checkbox" id="safety_very">
        <label for="safety_very">Very safe</label><br>

        <input type="radio" name="neighborhood_safety" value="Moderately safe" class="checkbox" id="safety_moderate">
        <label for="safety_moderate">Moderately safe</label><br>

        <input type="radio" name="neighborhood_safety" value="Unsafe" class="checkbox" id="safety_unsafe">
        <label for="safety_unsafe">Unsafe</label><br><br>

        <hr>

        <label>Presence of Security Measures</label><br><br>
        <input type="checkbox" name="security_measures[]" value="Fenced compound" class="checkbox" id="sec_fenced">
        <label for="sec_fenced">Fenced compound</label><br>

        <input type="checkbox" name="security_measures[]" value="Security guard" class="checkbox" id="sec_guard">
        <label for="sec_guard">Security guard</label><br>

        <input type="checkbox" name="security_measures[]" value="CCTV" class="checkbox" id="sec_cctv">
        <label for="sec_cctv">CCTV</label><br>

        <input type="checkbox" name="security_measures[]" value="Street light" class="checkbox" id="sec_light">
        <label for="sec_light">Street light</label><br>

        <input type="checkbox" name="security_measures[]" value="Neighborhood watch" class="checkbox" id="sec_watch">
        <label for="sec_watch">Neighborhood watch</label><br><br>

        <hr>

        <label for="road_accessibility">Accessibility to Road (Short answer)</label><br>
        <input type="text" name="road_accessibility" id="road_accessibility"><br><br>

        <div class="np">
          <div class="previous"><button type="button">Previous</button></div><br>
          <div class="next"><button type="button">Next</button></div>
        </div>
      </div>

      <!-- SECTION 6 -->
      <div class="container1" id="con6">
        <h2>Environment and Surrounding</h2>

        <label>Noise Level</label><br><br>
        <input type="radio" name="noise_level" value="Quiet" class="checkbox" id="noise_quiet">
        <label for="noise_quiet">Quiet</label><br>

        <input type="radio" name="noise_level" value="Moderate" class="checkbox" id="noise_moderate">
        <label for="noise_moderate">Moderate</label><br>

        <input type="radio" name="noise_level" value="Noisy" class="checkbox" id="noise_noisy">
        <label for="noise_noisy">Noisy</label><br><br>

        <hr>

        <label>Drainage Condition</label><br><br>
        <input type="radio" name="drainage_condition" value="Good" class="checkbox" id="drain_good">
        <label for="drain_good">Good</label><br>

        <input type="radio" name="drainage_condition" value="Blocked" class="checkbox" id="drain_blocked">
        <label for="drain_blocked">Blocked</label><br>

        <input type="radio" name="drainage_condition" value="No drainage" class="checkbox" id="drain_none">
        <label for="drain_none">No drainage</label><br><br>

        <hr>

        <label>Proximity to Market/Bus Stop</label><br><br>
        <input type="radio" name="proximity" value="Very close" class="checkbox" id="prox_close">
        <label for="prox_close">Very close</label><br>

        <input type="radio" name="proximity" value="Moderate distance" class="checkbox" id="prox_moderate">
        <label for="prox_moderate">Moderate distance</label><br>

        <input type="radio" name="proximity" value="Far" class="checkbox" id="prox_far">
        <label for="prox_far">Far</label><br><br>

        <div class="np">
          <div class="previous"><button type="button">Previous</button></div><br>
          <div class="next"><button type="button">Next</button></div>
        </div>
      </div>

           <!-- SECTION 7 -->
      <div class="container1" id="con7">
        <h2>Transportation and Accessibility</h2>

        <label>Primary Mode of Transportation</label><br><br>
        <input type="radio" name="transport_mode" value="Walking" class="checkbox" id="trans_walk">
        <label for="trans_walk">Walking</label><br>

        <input type="radio" name="transport_mode" value="Motorcycle" class="checkbox" id="trans_motor">
        <label for="trans_motor">Motorcycle</label><br>

        <input type="radio" name="transport_mode" value="Tricycle" class="checkbox" id="trans_tri">
        <label for="trans_tri">Tricycle</label><br>

        <input type="radio" name="transport_mode" value="Bus/Taxi" class="checkbox" id="trans_bus">
        <label for="trans_bus">Bus/Taxi</label><br>

        <input type="radio" name="transport_mode" value="Private car" class="checkbox" id="trans_car">
        <label for="trans_car">Private car</label><br><br>

        <hr>

        <label>Road Condition</label><br><br>
        <input type="radio" name="road_condition" value="Good" class="checkbox" id="road_good">
        <label for="road_good">Good</label><br>

        <input type="radio" name="road_condition" value="Fair" class="checkbox" id="road_fair">
        <label for="road_fair">Fair</label><br>

        <input type="radio" name="road_condition" value="Bad" class="checkbox" id="road_bad">
        <label for="road_bad">Bad</label><br><br>

        <div class="np">
          <div class="previous"><button type="button">Previous</button></div><br>
          <div class="next"><button type="button">Next</button></div>
        </div>
      </div>

      <!-- SECTION 8 -->
      <div class="container1" id="con8">
        <h2>Social and Community</h2>

        <label>Community Relationship</label><br><br>
        <input type="radio" name="community_relationship" value="Very friendly" class="checkbox" id="comm_friendly">
        <label for="comm_friendly">Very friendly</label><br>

        <input type="radio" name="community_relationship" value="Moderate" class="checkbox" id="comm_moderate">
        <label for="comm_moderate">Moderate</label><br>

        <input type="radio" name="community_relationship" value="Unfriendly" class="checkbox" id="comm_unfriendly">
        <label for="comm_unfriendly">Unfriendly</label><br><br>

        <hr>

        <label>Community Development Associations (CDA)</label><br><br>
        <input type="radio" name="cda_presence" value="Yes" class="checkbox" id="cda_yes">
        <label for="cda_yes">Yes</label><br>

        <input type="radio" name="cda_presence" value="No" class="checkbox" id="cda_no">
        <label for="cda_no">No</label><br><br>

        <hr>

        <label>Does the community organize regular meetings?</label><br><br>
        <input type="radio" name="community_meetings" value="Yes" class="checkbox" id="meet_yes">
        <label for="meet_yes">Yes</label><br>

        <input type="radio" name="community_meetings" value="No" class="checkbox" id="meet_no">
        <label for="meet_no">No</label><br><br>

        <div class="np">
          <div class="previous"><button type="button">Previous</button></div><br>
          <div class="next"><button type="button">Next</button></div>
        </div>
      </div>

      <!-- SECTION 9 -->
      <div class="container1" id="con9">
        <h2>Final Section — Feedback</h2>

        <label>What do you like most about your area?</label><br>
        <textarea name="area_likes" id="area_likes" rows="3" placeholder="Write your answer here..."></textarea><br><br>

        <label>What problems do you face in your area?</label><br>
        <textarea name="area_problems" id="area_problems" rows="3" placeholder="Write your answer here..."></textarea><br><br>

        <label>Suggestions for improvement</label><br>
        <textarea name="suggestions" id="suggestions" rows="3" placeholder="Write your answer here..."></textarea><br><br>

        <div class="np">
          <div class="previous"><button type="button">Previous</button></div><br>
                    <div class="next">
                        <button type="button" id="submitBtn">SUBMIT</button>
                    </div>
        </div>
      </div>
    </form>
  </div>
</body>

   <script>
// Get reference to the "Yes" button
const yesButton = document.getElementById("button1");

// Array of container IDs in order
const containers = [
    "con1", "con2", "con3", "con4", "con5", "con6", "con7", "con8", "con9"
];

let currentStep = 0;

// Show con2 when "Yes" is clicked
yesButton.addEventListener("click", (e) => {
    e.preventDefault();

    const currentContainer = document.getElementById(containers[currentStep]);

    // Get all required inputs inside current step
    const requiredFields = currentContainer.querySelectorAll("input[required], select[required], textarea[required]");

    let allFilled = true;

    requiredFields.forEach((field) => {
        if (!field.value.trim()) {
            allFilled = false;
            field.classList.add("error");  // Optional: highlight field
        } else {
            field.classList.remove("error");
        }
    });

    if (!allFilled) {
      const msgDiv = document.getElementById('error');
      msgDiv.textContent = "Please fill all required fields before continuing.";
      msgDiv.style.display = 'block';
      setTimeout(() => { msgDiv.style.display = 'none'; }, 4000);
      return; // Stop: do NOT move to next step
    }

    // All good → move to next step
    currentContainer.style.display = "none";
    currentStep++;
    document.getElementById(containers[currentStep]).style.display = "block";
});


// Handle all "Next" buttons
const nextButtons = document.querySelectorAll(".next button");
const previous = document.querySelectorAll(".previous button");

nextButtons.forEach((button) => {
    button.addEventListener("click", (e) => {
        e.preventDefault(); // prevent accidental form submission
        if (currentStep < containers.length - 1) {
            document.getElementById(containers[currentStep]).style.display = "none";
            currentStep++;
            document.getElementById(containers[currentStep]).style.display = "block";
        }
    });
});

previous.forEach(btn => {
    btn.addEventListener('click', (e) => {
        e.preventDefault();
        if (currentStep > 0) {
            document.getElementById(containers[currentStep]).style.display = 'none';
            currentStep--;
            document.getElementById(containers[currentStep]).style.display = 'block';
        }
    });
});


// ✅ Handle final form submission via the SUBMIT button
const submitBtn = document.getElementById('submitBtn');
submitBtn.addEventListener('click', async (e) => {
    e.preventDefault();

    const name = (document.getElementById('name').value || '').trim();
    const email = (document.getElementById('email').value || '').trim();

    if (!name || !email) {
      const msgDiv = document.getElementById('error');
      msgDiv.textContent = 'Please provide name and email before submitting.';
      msgDiv.style.display = 'block';
      setTimeout(() => { msgDiv.style.display = 'none'; }, 4000);
      return;
    }

    // Collect all inputs (text, radio, checkbox, select) into a single object
    const formEl = document.getElementById('surveyForm');
    const data = {};

    // Helper: get label text next to an input if the input has no value
    function findLabelText(input) {
        // try <label for="id"> pattern
        if (input.id) {
            const label = formEl.querySelector(`label[for="${input.id}"]`);
            if (label) return label.textContent.trim();
        }
        // fallback: look at the nearest sibling label
        const siblingLabel = input.parentElement && input.parentElement.querySelector('label');
        if (siblingLabel) return siblingLabel.textContent.trim();
        return '';
    }

    // Process text, email, number, textarea
    formEl.querySelectorAll('input[type="text"], input[type="email"], input[type="number"], textarea').forEach(inp => {
        if (inp.name) data[inp.name] = inp.value;
    });

    // Process selects
    formEl.querySelectorAll('select').forEach(sel => {
        if (!sel.name) return;
        data[sel.name] = sel.options[sel.selectedIndex]?.value || sel.options[sel.selectedIndex]?.text || '';
    });

    // Process radio groups (grouped by name)
    const radioNames = new Set(Array.from(formEl.querySelectorAll('input[type="radio"][name]')).map(r => r.name));
    radioNames.forEach(name => {
        const checked = formEl.querySelector(`input[type="radio"][name="${name}"]:checked`);
        if (checked) {
            data[name] = checked.value || findLabelText(checked) || 'selected';
        } else {
            data[name] = null;
        }
    });

    // Process checkboxes (could be multiple with same name -> array)
    const checkboxNames = new Set(Array.from(formEl.querySelectorAll('input[type="checkbox"][name]')).map(c => c.name));
    checkboxNames.forEach(name => {
        const boxes = Array.from(formEl.querySelectorAll(`input[type="checkbox"][name="${name}"]`));
        const checked = boxes.filter(b => b.checked).map(b => b.value || findLabelText(b));
        data[name] = checked.length === 1 ? checked[0] : checked; // single value or array
    });

    // include simple form fields captured by FormData as fallback (for any remaining named inputs)
    const fd = new FormData(formEl);
    for (const [k, v] of fd.entries()) {
        if (data[k] === undefined) data[k] = v;
    }

    // include ref if present
    const ref = new URLSearchParams(window.location.search).get('ref');
    if (ref) data.referrerUsername = ref;

    try {
        submitBtn.disabled = true;
        // Determine API endpoint. If the current page origin is not the backend (port 3000),
        // point requests at localhost:3000 where the Express API runs.
        // Allow overriding API base via meta tag <meta name="api-base" content="http://localhost:3000">
        const metaApi = document.querySelector('meta[name="api-base"]')?.getAttribute('content')?.trim();
        let apiBase = '';
        if (metaApi) {
            apiBase = metaApi.replace(/\/$/, ''); // strip trailing slash
        } else {
            // Default: if the page is served from backend (port 3000), use relative path; otherwise point to localhost:3000
            apiBase = ((window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') && window.location.port === '3000')
                ? ''
                : 'http://localhost:3000';
        }

        const apiUrl = apiBase + '/api/form/submit';

        console.log('Submitting to', apiUrl);
        try {
            console.log('Payload (object):', data);
            console.log('Payload (json):', JSON.stringify(data, null, 2));
        } catch (e) { console.log('Payload (string):', String(data)); }

        // Normalize common alternate keys so server receives `name` and `email`
        if (!data.name) {
            data.name = data.full_name || data.fullname || data['full-name'] || data['fullName'] || data['Full name'];
        }
        if (!data.email) {
            data.email = data.email_address || data['Email'] || data['emailAddress'];
        }

        // Defensive check: ensure name and email are present before sending
        if (!data.name || !data.email) {
            // Detailed diagnostics
            const nameEl = document.getElementById('name');
            const emailEl = document.getElementById('email');
            const diag = {
                payload: data,
                nameElementExists: !!nameEl,
                nameElementValue: nameEl ? nameEl.value : null,
                nameElementNameAttr: nameEl ? nameEl.getAttribute('name') : null,
                emailElementExists: !!emailEl,
                emailElementValue: emailEl ? emailEl.value : null,
                emailElementNameAttr: emailEl ? emailEl.getAttribute('name') : null,
            };

            console.error('Aborting submit: name or email missing in payload', diag);

            // Show diagnostics in a visible panel on the page for easy copy/paste
            let dbg = document.getElementById('submitDebug');
            if (!dbg) {
                dbg = document.createElement('pre');
                dbg.id = 'submitDebug';
                dbg.style = 'position:fixed;right:10px;bottom:10px;z-index:9999;background:#fff;border:1px solid #ccc;padding:10px;max-width:400px;max-height:250px;overflow:auto;font-size:12px';
                document.body.appendChild(dbg);
            }
            dbg.textContent = JSON.stringify(diag, null, 2);

            const msgDiv = document.getElementById('error');
            msgDiv.textContent = 'Please provide name and email before submitting. See debug panel for details.';
            msgDiv.style.display = 'block';
            setTimeout(() => { msgDiv.style.display = 'none'; }, 4000);
            // focus the missing input if possible
            if (!data.name) document.getElementById('name')?.focus();
            else if (!data.email) document.getElementById('email')?.focus();
            submitBtn.disabled = false;
            return;
        }
    const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
        });

        // Safely handle empty or non-JSON responses
        const text = await response.text();
        let result = {};
        try {
            result = text ? JSON.parse(text) : {};
        } catch (parseErr) {
            // response wasn't JSON — keep raw text for diagnostics
            result = { message: text };
            console.warn('Non-JSON response from server:', text);
        }

        if (response.ok) {
          // show a quick success and redirect
          const msgDiv = document.getElementById('message');
          msgDiv.textContent = '✅ Survey submitted successfully!';
          msgDiv.style.display = 'block';
          setTimeout(() => {
            msgDiv.style.display = 'none';
            const thankyouUrl = (apiBase || '') + '/thankyou.html' + (ref ? `?ref=${encodeURIComponent(ref)}` : '');
            window.location.href = thankyouUrl;
          }, 2000);
        } else {
          // Show status and server message for easier debugging
          const serverMsg = result && result.message ? result.message : text || response.statusText;
          const msgDiv = document.getElementById('error');
          msgDiv.textContent = '❌ Error: ' + serverMsg + ' (HTTP ' + response.status + ')';
          msgDiv.style.display = 'block';
          setTimeout(() => { msgDiv.style.display = 'none'; }, 4000);
          console.error('Server response', { status: response.status, body: text, parsed: result });
        }
    } catch (error) {
      console.error('Error submitting form:', error);
      const msgDiv = document.getElementById('error');
      msgDiv.textContent = '⚠️ Failed to connect to server.';
      msgDiv.style.display = 'block';
      setTimeout(() => { msgDiv.style.display = 'none'; }, 4000);
    } finally {
      submitBtn.disabled = false;
    }
});


   
   </script>

    
</body>
</html>